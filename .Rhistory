risk_hourly = m1 %>% select(date, site, AQHI, siteMax, o3_ug, no2_ug, so2_ug, rsp, nox_ug) %>%
mutate(rO3 = (exp(f_o3*o3_ug)-1)*100, rNO2 = (exp(f_no2*no2_ug)-1)*100, rSO2 = (exp(f_so2*so2_ug)-1)*100,
rRSP = (exp(f_rsp*rsp)-1)*100, contri_O3 = round(rO3/(rO3+rNO2+rSO2+rRSP)*100, 1),
contri_NO2 = round(rNO2/(rO3+rNO2+rSO2+rRSP)*100, 1), contri_SO2 = round(rSO2/(rO3+rNO2+rSO2+rRSP)*100,1),
contri_RSP = round(rRSP/(rO3+rNO2+rSO2+rRSP)*100,1), Ox_ppb = o3_ug/1.996464+no2_ug/1.913278)
risk_hourly$Max = apply(risk_hourly %>% select(rO3, rNO2, rRSP, rSO2), 1, max)
View(risk_hourly)
View(risk_hourly)
Rank1 = match(risk_hourly$max, risk_hourly[,c(10:13)])
head(risk_hourly[,c(10:13)])
Rank1 = match(risk_hourly[,c("Max")], risk_hourly[,c(10:13)])
Rank1[1]
Rank1[2]
Rank1[1:10]
Rank1[1:100]
Rank1[1:1000]
Rank1 = match(risk_hourly[1,c("Max")], risk_hourly[1,c(10:13)])
Rank1
Rank1 = match(risk_hourly[1:100,c("Max")], risk_hourly[1:100,c(10:13)])
Rank1
for (i in 1:200){}
for (i in 1:200){
Rank1[i] = match(risk_hourly[i,c("Max")], risk_hourly[i,c(10:13)])}
Rank1
dim(risk_hourly)
dim(risk_hourly$Max)
dim(risk_hourly)[2]
for (i = 1:dim(risk_hourly)[1]){
Rank1[i] = match(risk_hourly[i,c("Max")], risk_hourly[i,c(10:13)])
}
risk_hourly$Rank = NA
risk_hourly$Rank = NA
for (i in 1:dim(risk_hourly)[1]){
risk_hourly$Rank[i] = match(risk_hourly[i,c("Max")], risk_hourly[i,c(10:13)])
}
for (i in 1:1000){
Rank1[i] = match(risk_hourly[i,c("Max")], risk_hourly[i,c(10:13)])
}
for (i in 1:10000){
Rank1[i] = match(risk_hourly[i,c("Max")], risk_hourly[i,c(10:13)])
}
for (i in 1:dim(risk_hourly)[1]){
Rank1[i] = match(risk_hourly[i,c("Max")], risk_hourly[i,c(10:13)])
}
for (i in 1:dim(risk_hourly)[1]){
Rank1[i] = match(risk_hourly[i,c("Max")], risk_hourly[i,c(10:13)])
print(i)
}
aa = apply(risk_hourly[1:100,c(10:13)], 1, FUN = mean)
aa
aa = apply(risk_hourly[1:10,c(10:13)], 1, FUN = mean)
aa
aa = apply(risk_hourly[1:10,c(10:13)], 1, FUN = max)
aa
aa = apply(risk_hourly[1:10,c(10:13)], 1, FUN = max(x))
aa
aa = apply(risk_hourly[1:10,c(10:13)], 1, FUN = match(max(x), x))
?apply
aa = apply(risk_hourly[1:10,c(10:13)], 1, function(x) match(max(x), x))
aa
aa = apply(risk_hourly[1:10,c(14:17)], 1, function(x) match(max(x), x))
aa
bb = apply(risk_hourly[1:10,c(14:17)], 1, function(x) max(x))
bb
aa = apply(risk_hourly[1:10,c(14:17)], 1, function(x) if (is.na(max(x))) {NA} else {match(max(x), x)})
aa
?match
aa = apply(risk_hourly[1:10,c(14:17)], 1, function(x) match(max(x), x, incomparables = NA))
aa
aa = apply(risk_hourly[1:10,c(14:17)], 1, function(x) match(max(x), x, incomparables = NA, nomatch = "AAA"))
aa
aa = apply(risk_hourly[1:10,c(14:17)], 1, function(x) match(max(x), x, incomparables = NA, nomatch = 0))
aa
aa = apply(risk_hourly[1:10,c(14:17)], 1, function(x) match(max(x), x, incomparables = NA, nomatch = "0"))
aa
aa = apply(risk_hourly[1:10,c(14:17)], 1, function(x) match(max(x), x, incomparables = NA, nomatch = "a"))
aa
aa = apply(risk_hourly[1:10,c(14:17)], 1, function(x) match(max(x), x, incomparables = NA, nomatch = NA))
aa
?switch
switch(2, c("a","b","c","d"))
a = switch(2, c("a","b","c","d"))
a
a = switch(2, "a","b","c","d")
a
aa = apply(risk_hourly[1:10,c(14:17)], 1, function(x) switch(match(max(x), x, incomparables = NA, nomatch = NA),
"O3", "NO2", "SO2", "RSP"))
aa
pollutant_vec
aa = apply(risk_hourly[1:10,c(14:17)], 1, function(x) vec1[match(max(x), x, incomparables = NA, nomatch = NA)])
vec1 = c("O3", "NO2", "SO2", "RSP")
aa = apply(risk_hourly[1:10,c(14:17)], 1, function(x) vec1[match(max(x), x, incomparables = NA, nomatch = NA)])
aa
risk_hourly$dom = apply(risk_hourly[1:10,c(14:17)], 1,
function(x) vec1[match(max(x), x, incomparables = NA, nomatch = NA)])
apply(risk_hourly[1:10,c(14:17)], 1,
function(x) vec1[match(max(x), x, incomparables = NA, nomatch = NA)])
aa = apply(risk_hourly[1:10,c(14:17)], 1,
function(x) vec1[match(max(x), x, incomparables = NA, nomatch = NA)])
length(aa)
risk_hourly$dom = apply(risk_hourly[,c(14:17)], 1,
function(x) vec1[match(max(x), x, incomparables = NA, nomatch = NA)])
View(risk_hourly)
## 2b) Risk Contribution to %AR
risk_hourly = m1 %>% select(date, site, AQHI, siteMax, o3_ug, no2_ug, so2_ug, rsp, nox_ug) %>%
mutate(rO3 = (exp(f_o3*o3_ug)-1)*100, rNO2 = (exp(f_no2*no2_ug)-1)*100, rSO2 = (exp(f_so2*so2_ug)-1)*100,
rRSP = (exp(f_rsp*rsp)-1)*100, contri_O3 = round(rO3/(rO3+rNO2+rSO2+rRSP)*100, 1),
contri_NO2 = round(rNO2/(rO3+rNO2+rSO2+rRSP)*100, 1), contri_SO2 = round(rSO2/(rO3+rNO2+rSO2+rRSP)*100,1),
contri_RSP = round(rRSP/(rO3+rNO2+rSO2+rRSP)*100,1), Ox_ppb = o3_ug/1.996464+no2_ug/1.913278)
risk_hourly$dom = apply(risk_hourly[,c(14:17)], 1,
function(x) vec1[match(max(x), x, incomparables = NA, nomatch = NA)])
WriteCSV_ToFolder(dir_West_v_East, dir_Master, risk_hourly %>% select(date, site, AQHI, siteMax, contri_O3,
contri_NO2, contri_SO2, contri_RSP, o3_ug, no2_ug, so2_ug, rsp, nox_ug, Ox_ppb, dom), "risk_hourly.csv")
source('setup.R')
source('functions.R')
source('parameters.R')
setwd(dir_Master)
# ----  ----  ----  ----  ----  ----  ----  ----  ----  ----  ----  ----  ----  ----
# ----  ----  ----  ----  ----  ----  ----  ----  ----  ----  ----  ----  ----  ----
# 1. Load and Combine Data
####  GI = Green Island
####  HKO = HKO
####  KP = King's Park
####  R2C = Airport
####  SE = Kai Tak
####  SHA = ShaTin
####  SHL = TsingYi Shell
####  TAP = Tap Mun
####  TUN = Tuen Mun
####  WGL = Wagland
####  JKB = TKO
####  SKG = Sai Kung
####  NP = North Point
####  SF = Star Ferry
####  TC = Tate's Carin
####  LFS = Lau Fau Shan
####  TMS = Tai Mo Shan
# Load Wind Data
wind_Vec = c("R2C", "TUN", "LFS", "SF", "KP", "HKO", "SE", "SHA", "WGL")
w1 = LoadWind(dir_Wind, dir_Master, 2014:2016, wind_Vec)
## Load and combine hourly air data
air_Vec = c("date", "site","o3_ug", "no2_ug", "nox_ug", "so2_ug", "rsp", "fsp")
r1 = LoadAirHour(dir_AirHour, dir_Master, 2014:2016, air_Vec)
## Load AQHI data
a1 = LoadAQHI(dir_AQHI, dir_Master, 2014:2016)
## Match airData and AQHIdata
m1 = merge.data.frame(r1 %>% mutate(tag = paste(date, site)),
a1 %>% mutate(tag = paste(date, site)) %>% select(-c(date, site)), by = "tag", all.x = T) %>%
select(-c(tag))
## Match airData and AQHIdata and windData
m2 = merge.data.frame(m1, w1[[1]], by = "date", all.x = T)
for (j in 2:length(wind_Vec)){
m2 = merge.data.frame(m2, w1[[j]], by = "date", all.x = T)
}
# Load Data End
# ********************************************************************************
# ********************************************************************************
roll3hr = m2
roll3hr = rollingMean(roll3hr, pollutant = c("o3_ug"), align = "right", width = 3,
data.thresh = 66.6, type = "site", new.name = "r3_O3")
roll3hr = rollingMean(roll3hr, pollutant = c("no2_ug"), align = "right", width = 3,
data.thresh = 66.6, type = "site", new.name = "r3_NO2")
roll3hr = rollingMean(roll3hr, pollutant = c("so2_ug"), align = "right", width = 3,
data.thresh = 66.6, type = "site", new.name = "r3_SO2")
roll3hr = rollingMean(roll3hr, pollutant = c("rsp"), align = "right", width = 3,
data.thresh = 66.6, type = "site", new.name = "r3_RSP")
roll3hr = rollingMean(roll3hr, pollutant = c("nox_ug"), align = "right", width = 3,
data.thresh = 66.6, type = "site", new.name = "r3_NOx")
risk_hourly = roll3hr %>%
mutate(rO3 = (exp(f_o3*r3_O3)-1)*100, rNO2 = (exp(f_no2*r3_NO2)-1)*100, rSO2 = (exp(f_so2*r3_SO2)-1)*100,
rRSP = (exp(f_rsp*r3_RSP)-1)*100, contri_O3 = round(rO3/(rO3+rNO2+rSO2+rRSP)*100, 1),
contri_NO2 = round(rNO2/(rO3+rNO2+rSO2+rRSP)*100,1), contri_SO2 = round(rSO2/(rO3+rNO2+rSO2+rRSP)*100,1),
contri_RSP = round(rRSP/(rO3+rNO2+rSO2+rRSP)*100,1), Ox_ppb = round(r3_O3/1.996464+r3_NO2/1.913278,1))
names(risk_hourly[c("r3_O3", "r3_NO2", "r3_SO2", "r3_RSP", "r3_NOx")]) =
c("o3_ug", "no2_ug", "so2_ug", "rsp", "nox_ug")
vec1 = c("O3", "NO2", "SO2", "RSP")
head(risk_hourly[,c(38:41)])
risk_hourly$dom = apply(risk_hourly[,c(38:41)], 1,
function(x) vec1[match(max(x), x, incomparables = NA, nomatch = NA)])
p1 = windRose(risk_hourly %>% filter(dom == "NO2", AQHI >= 7), ws = "ws_TUN", wd = "wd_TUN", type = "site")
p1 = windRose(risk_hourly %>% filter(dom == "NO2", AQHI >= 7), ws = "ws_TUN", wd = "wd_TUN", type = "site",
breaks = ws.Class, paddle = F)
p1 = windRose(risk_hourly %>% filter(dom == "NO2", AQHI >= 7, site == "TM_HK"), ws = "ws_TUN", wd = "wd_TUN", type = "site",
breaks = ws.Class, paddle = F)
p1 = windRose(risk_hourly %>% filter(dom == "RSP", AQHI >= 7, site == "TM_HK"), ws = "ws_TUN", wd = "wd_TUN",
type = "site",
breaks = ws.Class, paddle = F)
p1 = windRose(risk_hourly %>% filter(AQHI >= 7, site == "TM_HK"), ws = "ws_TUN", wd = "wd_TUN",
type = "dom",
breaks = ws.Class, paddle = F)
p1 = windRose(risk_hourly %>% filter(AQHI >= 8, site == "TM_HK"), ws = "ws_TUN", wd = "wd_TUN",
type = "dom",
breaks = ws.Class, paddle = F)
p1 = windRose(risk_hourly %>% filter(AQHI >= 9, site == "TM_HK"), ws = "ws_TUN", wd = "wd_TUN",
type = "dom",
breaks = ws.Class, paddle = F)
p1 = windRose(risk_hourly %>% filter(AQHI >= 9, site == "TM_HK"), ws = "ws_R2C", wd = "wd_R2C",
type = "dom",
breaks = ws.Class, paddle = F)
p1 = windRose(risk_hourly %>% filter(AQHI >= 7, site == "TM_HK"), ws = "ws_R2C", wd = "wd_R2C",
type = "dom",
breaks = ws.Class, paddle = F)
risk_WindSpeed = timeAverage(risk_hourly, avg.time = "year", type = "site")
View(risk_WindSpeed)
risk_hourly$siteDom = paste(risk_hourly$site, risk_hourly$dom, sep = "_")
risk_WindSpeed = timeAverage(risk_hourly, avg.time = "year", type = "siteDom")
View(risk_WindSpeed)
risk_WindSpeed = timeAverage(risk_hourly, avg.time = "month", type = "siteDom")
WriteCSV_ToFolder(dir_West_v_East, dir_Master, risk_WindSpeed, "risk_speed.csv")
risk_hourly$siteDom = paste(risk_hourly$site, risk_hourly$dom, sep = "_")
risk_WindSpeed = timeAverage(risk_hourly %>% filter(AQHI >= 7), avg.time = "month", type = "siteDom")
WriteCSV_ToFolder(dir_West_v_East, dir_Master, risk_WindSpeed, "risk_speed.csv")
source('setup.R')
source('functions.R')
source('parameters.R')
setwd(dir_Master)
# ----  ----  ----  ----  ----  ----  ----  ----  ----  ----  ----  ----  ----  ----
# ----  ----  ----  ----  ----  ----  ----  ----  ----  ----  ----  ----  ----  ----
# 1. Load and Combine Data
####  GI = Green Island
####  HKO = HKO
####  KP = King's Park
####  R2C = Airport
####  SE = Kai Tak
####  SHA = ShaTin
####  SHL = TsingYi Shell
####  TAP = Tap Mun
####  TUN = Tuen Mun
####  WGL = Wagland
####  JKB = TKO
####  SKG = Sai Kung
####  NP = North Point
####  SF = Star Ferry
####  TC = Tate's Carin
####  LFS = Lau Fau Shan
####  TMS = Tai Mo Shan
## Load and combine hourly air data
air_Vec = c("date", "site","o3_ug", "no2_ug", "nox_ug", "so2_ug", "rsp", "fsp")
r1 = LoadAirHour(dir_AirHour, dir_Master, 2014:2016, air_Vec)
## Load AQHI data
a1 = LoadAQHI(dir_AQHI, dir_Master, 2014:2016)
## Match airData and AQHIdata
m1 = merge.data.frame(r1 %>% mutate(tag = paste(date, site)),
a1 %>% mutate(tag = paste(date, site)) %>% select(-c(date, site)), by = "tag", all.x = T) %>%
select(-c(tag))
## 2b) Risk Contribution to %AR
roll3hr = m1
roll3hr = rollingMean(roll3hr, pollutant = c("o3_ug"), align = "right", width = 3,
data.thresh = 66.6, type = "site", new.name = "r3_O3")
roll3hr = rollingMean(roll3hr, pollutant = c("no2_ug"), align = "right", width = 3,
data.thresh = 66.6, type = "site", new.name = "r3_NO2")
roll3hr = rollingMean(roll3hr, pollutant = c("so2_ug"), align = "right", width = 3,
data.thresh = 66.6, type = "site", new.name = "r3_SO2")
roll3hr = rollingMean(roll3hr, pollutant = c("rsp"), align = "right", width = 3,
data.thresh = 66.6, type = "site", new.name = "r3_RSP")
roll3hr = rollingMean(roll3hr, pollutant = c("nox_ug"), align = "right", width = 3,
data.thresh = 66.6, type = "site", new.name = "r3_NOx")
View(roll3hr)
source('setup.R')
source('functions.R')
source('parameters.R')
setwd(dir_Master)
# ----  ----  ----  ----  ----  ----  ----  ----  ----  ----  ----  ----  ----  ----
# ----  ----  ----  ----  ----  ----  ----  ----  ----  ----  ----  ----  ----  ----
# 1. Load and Combine Data
####  GI = Green Island
####  HKO = HKO
####  KP = King's Park
####  R2C = Airport
####  SE = Kai Tak
####  SHA = ShaTin
####  SHL = TsingYi Shell
####  TAP = Tap Mun
####  TUN = Tuen Mun
####  WGL = Wagland
####  JKB = TKO
####  SKG = Sai Kung
####  NP = North Point
####  SF = Star Ferry
####  TC = Tate's Carin
####  LFS = Lau Fau Shan
####  TMS = Tai Mo Shan
## Load and combine hourly air data
air_Vec = c("date", "site","o3_ug", "no2_ug", "nox_ug", "so2_ug", "rsp", "fsp")
r1 = LoadAirHour(dir_AirHour, dir_Master, 2013:2016, air_Vec)
## Load AQHI data
a1 = LoadAQHI(dir_AQHI, dir_Master, 2013:2016)
## Match airData and AQHIdata
m1 = merge.data.frame(r1 %>% mutate(tag = paste(date, site)),
a1 %>% mutate(tag = paste(date, site)) %>% select(-c(date, site)), by = "tag", all.x = T) %>%
select(-c(tag))
roll3hr = m1
roll3hr = rollingMean(roll3hr, pollutant = c("o3_ug"), align = "right", width = 3,
data.thresh = 66.6, type = "site", new.name = "r3_O3")
roll3hr = rollingMean(roll3hr, pollutant = c("no2_ug"), align = "right", width = 3,
data.thresh = 66.6, type = "site", new.name = "r3_NO2")
roll3hr = rollingMean(roll3hr, pollutant = c("so2_ug"), align = "right", width = 3,
data.thresh = 66.6, type = "site", new.name = "r3_SO2")
roll3hr = rollingMean(roll3hr, pollutant = c("rsp"), align = "right", width = 3,
data.thresh = 66.6, type = "site", new.name = "r3_RSP")
roll3hr = rollingMean(roll3hr, pollutant = c("nox_ug"), align = "right", width = 3,
data.thresh = 66.6, type = "site", new.name = "r3_NOx")
roll3hr = selectByDate(roll3hr, year = 2014:2016)
View(roll3hr)
AR = exp(o3_r3*f_o3)-1
Cal_AQHI.ug = function(o3_r3, no2_r3, rsp_r3, so2_r3){
AR = (exp(o3_r3*f_o3)-1 + exp(no2_r3*f_no2)-1 + exp(rsp_r3*f_rsp)-1 + exp(so2_r3*f_so2)-1)*100
}
### Function 5 Calculate AQHI
Cal_AQHI.ug = function(o3_r3, no2_r3, rsp_r3, so2_r3){
AR = (exp(o3_r3*f_o3)-1 + exp(no2_r3*f_no2)-1 + exp(rsp_r3*f_rsp)-1 + exp(so2_r3*f_so2)-1)*100
return(AR)
}
roll3hr$CalAQHI = Cal_AQHI.ug(r3_O3, r3_NO2, r3_RSP, r3_SO2)
roll3hr = m1
roll3hr = rollingMean(roll3hr, pollutant = c("o3_ug"), align = "right", width = 3,
data.thresh = 66.6, type = "site", new.name = "r3_O3")
roll3hr = rollingMean(roll3hr, pollutant = c("no2_ug"), align = "right", width = 3,
data.thresh = 66.6, type = "site", new.name = "r3_NO2")
roll3hr = rollingMean(roll3hr, pollutant = c("so2_ug"), align = "right", width = 3,
data.thresh = 66.6, type = "site", new.name = "r3_SO2")
roll3hr = rollingMean(roll3hr, pollutant = c("rsp"), align = "right", width = 3,
data.thresh = 66.6, type = "site", new.name = "r3_RSP")
roll3hr = rollingMean(roll3hr, pollutant = c("nox_ug"), align = "right", width = 3,
data.thresh = 66.6, type = "site", new.name = "r3_NOx")
roll3hr = selectByDate(roll3hr, year = 2014:2016)
roll3hr$CalAQHI = Cal_AQHI.ug(r3_O3, r3_NO2, r3_RSP, r3_SO2)
r3_O3
roll3hr$CalAQHI = Cal_AQHI.ug(roll3hr$r3_O3, roll3hr$r3_NO2, roll3hr$r3_RSP, roll3hr$r3_SO2)
View(roll3hr)
?Cal_AQHI.ug
roll3hr$CalAQHI = Cal_AQHI.ug(roll3hr$r3_O3, roll3hr$r3_NO2, roll3hr$r3_RSP, roll3hr$r3_SO2)
View(roll3hr)
roll3hr$CalAQHI2 = Cal_AQHI.ug(roll3hr$o3_ug, roll3hr$no2_ug, roll3hr$rsp, roll3hr$so2_ug)
View(roll3hr)
### Function 5 Calculate AQHI
Cal_AQHI.ug = function(o3_r3, no2_r3, rsp_r3, so2_r3){
AR = (exp(round(o3_r3,0)*f_o3)-1 + exp(round(no2_r3,0)*f_no2)-1 + exp(round(rsp_r3,0)*f_rsp)-1 + exp(round(so2_r3,0)*f_so2)-1)*100
AQHI_Class = AR
AQHI_Class = "aqhi_01"
AQHI_Class[which(AR > aqhi_02)] = "aqhi_02"
AQHI_Class[which(AR > aqhi_03)] = "aqhi_03"
AQHI_Class[which(AR > aqhi_04)] = "aqhi_04"
AQHI_Class[which(AR > aqhi_05)] = "aqhi_05"
AQHI_Class[which(AR > aqhi_06)] = "aqhi_06"
AQHI_Class[which(AR > aqhi_07)] = "aqhi_07"
AQHI_Class[which(AR > aqhi_08)] = "aqhi_08"
AQHI_Class[which(AR > aqhi_09)] = "aqhi_09"
AQHI_Class[which(AR > aqhi_10)] = "aqhi_10"
AQHI_Class[which(AR > aqhi_11)] = "aqhi_11"
return(AQHI_Class, AR)
}
roll3hr$CalAQHI2[2] = Cal_AQHI.ug(roll3hr$o3_ug, roll3hr$no2_ug, roll3hr$rsp, roll3hr$so2_ug)
Cal_AQHI.ug = function(o3_r3, no2_r3, rsp_r3, so2_r3){
AR = (exp(round(o3_r3,0)*f_o3)-1 + exp(round(no2_r3,0)*f_no2)-1 + exp(round(rsp_r3,0)*f_rsp)-1 + exp(round(so2_r3,0)*f_so2)-1)*100
AQHI_Class = AR
AQHI_Class = "aqhi_01"
AQHI_Class[which(AR > aqhi_02)] = "aqhi_02"
AQHI_Class[which(AR > aqhi_03)] = "aqhi_03"
AQHI_Class[which(AR > aqhi_04)] = "aqhi_04"
AQHI_Class[which(AR > aqhi_05)] = "aqhi_05"
AQHI_Class[which(AR > aqhi_06)] = "aqhi_06"
AQHI_Class[which(AR > aqhi_07)] = "aqhi_07"
AQHI_Class[which(AR > aqhi_08)] = "aqhi_08"
AQHI_Class[which(AR > aqhi_09)] = "aqhi_09"
AQHI_Class[which(AR > aqhi_10)] = "aqhi_10"
AQHI_Class[which(AR > aqhi_11)] = "aqhi_11"
return(AQHI_Class)
}
roll3hr$CalAQHI2 = Cal_AQHI.ug(roll3hr$o3_ug, roll3hr$no2_ug, roll3hr$rsp, roll3hr$so2_ug)
Cal_AQHI.ug = function(o3_r3, no2_r3, rsp_r3, so2_r3){
AR = (exp(round(o3_r3,0)*f_o3)-1 + exp(round(no2_r3,0)*f_no2)-1 + exp(round(rsp_r3,0)*f_rsp)-1 + exp(round(so2_r3,0)*f_so2)-1)*100
AQHI_Class = AR
AQHI_Class[which(AR > aqhi_02)] = NA
AQHI_Class[which(AR > aqhi_01)] = "aqhi_01"
AQHI_Class[which(AR > aqhi_02)] = "aqhi_02"
AQHI_Class[which(AR > aqhi_03)] = "aqhi_03"
AQHI_Class[which(AR > aqhi_04)] = "aqhi_04"
AQHI_Class[which(AR > aqhi_05)] = "aqhi_05"
AQHI_Class[which(AR > aqhi_06)] = "aqhi_06"
AQHI_Class[which(AR > aqhi_07)] = "aqhi_07"
AQHI_Class[which(AR > aqhi_08)] = "aqhi_08"
AQHI_Class[which(AR > aqhi_09)] = "aqhi_09"
AQHI_Class[which(AR > aqhi_10)] = "aqhi_10"
AQHI_Class[which(AR > aqhi_11)] = "aqhi_11"
return(AQHI_Class)
}
roll3hr$CalAQHI2 = Cal_AQHI.ug(roll3hr$o3_ug, roll3hr$no2_ug, roll3hr$rsp, roll3hr$so2_ug)
View(roll3hr)
roll3hr$CalAQHI = Cal_AQHI.ug(roll3hr$r3_O3, roll3hr$r3_NO2, roll3hr$r3_RSP, roll3hr$r3_SO2)
View(roll3hr)
Cal_AQHI.ug = function(o3_r3, no2_r3, rsp_r3, so2_r3){
AR = (exp(round(o3_r3,0)*f_o3)-1 + exp(round(no2_r3,0)*f_no2)-1 + exp(round(rsp_r3,0)*f_rsp)-1 + exp(round(so2_r3,0)*f_so2)-1)*100
AQHI_Class = AR
AQHI_Class[which(AR > aqhi_02)] = NA
AQHI_Class[which(AR > aqhi_01)] = "aqhi_01"
AQHI_Class[which(AR > aqhi_02)] = "aqhi_02"
AQHI_Class[which(AR > aqhi_03)] = "aqhi_03"
AQHI_Class[which(AR > aqhi_04)] = "aqhi_04"
AQHI_Class[which(AR > aqhi_05)] = "aqhi_05"
AQHI_Class[which(AR > aqhi_06)] = "aqhi_06"
AQHI_Class[which(AR > aqhi_07)] = "aqhi_07"
AQHI_Class[which(AR > aqhi_08)] = "aqhi_08"
AQHI_Class[which(AR > aqhi_09)] = "aqhi_09"
AQHI_Class[which(AR > aqhi_10)] = "aqhi_10"
AQHI_Class[which(AR > aqhi_11)] = "aqhi_11"
return(AR)
}
roll3hr$CalAQHI = Cal_AQHI.ug(roll3hr$r3_O3, roll3hr$r3_NO2, roll3hr$r3_RSP, roll3hr$r3_SO2)
roll3hr$CalAQHI2 = Cal_AQHI.ug(roll3hr$o3_ug, roll3hr$no2_ug, roll3hr$rsp, roll3hr$so2_ug)
roll3hr = m1
roll3hr = rollingMean(roll3hr, pollutant = c("o3_ug"), align = "right", width = 3,
data.thresh = 66.6, type = "site", new.name = "r3_O3")
roll3hr = rollingMean(roll3hr, pollutant = c("no2_ug"), align = "right", width = 3,
data.thresh = 66.6, type = "site", new.name = "r3_NO2")
roll3hr = rollingMean(roll3hr, pollutant = c("so2_ug"), align = "right", width = 3,
data.thresh = 66.6, type = "site", new.name = "r3_SO2")
roll3hr = rollingMean(roll3hr, pollutant = c("rsp"), align = "right", width = 3,
data.thresh = 66.6, type = "site", new.name = "r3_RSP")
roll3hr = rollingMean(roll3hr, pollutant = c("nox_ug"), align = "right", width = 3,
data.thresh = 66.6, type = "site", new.name = "r3_NOx")
roll3hr = selectByDate(roll3hr, year = 2014:2016)
View(roll3hr)
roll3hr = m1
roll3hr = rollingMean(roll3hr, pollutant = c("o3_ug"), align = "right", width = 3,
data.thresh = 66.6, type = "site", new.name = "r3_O3")
roll3hr = rollingMean(roll3hr, pollutant = c("no2_ug"), align = "right", width = 3,
data.thresh = 66.6, type = "site", new.name = "r3_NO2")
roll3hr = rollingMean(roll3hr, pollutant = c("so2_ug"), align = "right", width = 3,
data.thresh = 66.6, type = "site", new.name = "r3_SO2")
roll3hr = rollingMean(roll3hr, pollutant = c("rsp"), align = "right", width = 3,
data.thresh = 66.6, type = "site", new.name = "r3_RSP")
roll3hr = rollingMean(roll3hr, pollutant = c("nox_ug"), align = "right", width = 3,
data.thresh = 66.6, type = "site", new.name = "r3_NOx")
roll3hr = selectByDate(roll3hr, year = 2014:2016)
risk_hourly = roll3hr %>%
mutate(rO3 = (exp(f_o3*r3_O3)-1)*100, rNO2 = (exp(f_no2*r3_NO2)-1)*100, rSO2 = (exp(f_so2*r3_SO2)-1)*100,
rRSP = (exp(f_rsp*r3_RSP)-1)*100, contri_O3 = round(rO3/(rO3+rNO2+rSO2+rRSP)*100, 1),
contri_NO2 = round(rNO2/(rO3+rNO2+rSO2+rRSP)*100,1), contri_SO2 = round(rSO2/(rO3+rNO2+rSO2+rRSP)*100,1),
contri_RSP = round(rRSP/(rO3+rNO2+rSO2+rRSP)*100,1), Ox_ppb = round(r3_O3/1.996464+r3_NO2/1.913278,1))
vec1 = c("O3", "NO2", "SO2", "RSP")
risk_hourly$dom = apply(risk_hourly[,c("", "", "", "")], 1,
function(x) vec1[match(max(x), x, incomparables = NA, nomatch = NA)])
risk_hourly_Dup_11 = risk_hourly %>% filter(AQHI == 11)
risk_hourly_Dup_11$AQHI = "Dup_11"
risk_hourly_Dup_11$siteMax = "Dup_11"
risk_hourly = rbind.data.frame(risk_hourly, risk_hourly_Dup_11)
View(risk_hourly)
names(risk_hourly)
head(risk_hourly[c("fsp", "r3_O3", "r3_NO2", "r3_SO2", "r3_RSP", "r3_NOx", "rO3", "rNO2", "rSO2", "rRSP")])
risk_hourly[c("fsp", "r3_O3", "r3_NO2", "r3_SO2", "r3_RSP", "r3_NOx", "rO3", "rNO2", "rSO2", "rRSP")] = NULL
head(risk_hourly)
WriteCSV_ToFolder(dir_West_v_East, dir_Master, risk_hourly, "risk_hourly.csv")
vec1 = c("O3", "NO2", "SO2", "RSP")
risk_hourly$dom = apply(risk_hourly[,c(38:41)], 1,
function(x) vec1[match(max(x), x, incomparables = NA, nomatch = NA)])
roll3hr = m1
roll3hr = rollingMean(roll3hr, pollutant = c("o3_ug"), align = "right", width = 3,
data.thresh = 66.6, type = "site", new.name = "r3_O3")
roll3hr = rollingMean(roll3hr, pollutant = c("no2_ug"), align = "right", width = 3,
data.thresh = 66.6, type = "site", new.name = "r3_NO2")
roll3hr = rollingMean(roll3hr, pollutant = c("so2_ug"), align = "right", width = 3,
data.thresh = 66.6, type = "site", new.name = "r3_SO2")
roll3hr = rollingMean(roll3hr, pollutant = c("rsp"), align = "right", width = 3,
data.thresh = 66.6, type = "site", new.name = "r3_RSP")
roll3hr = rollingMean(roll3hr, pollutant = c("nox_ug"), align = "right", width = 3,
data.thresh = 66.6, type = "site", new.name = "r3_NOx")
roll3hr = selectByDate(roll3hr, year = 2014:2016)
risk_hourly = roll3hr %>%
mutate(rO3 = (exp(f_o3*r3_O3)-1)*100, rNO2 = (exp(f_no2*r3_NO2)-1)*100, rSO2 = (exp(f_so2*r3_SO2)-1)*100,
rRSP = (exp(f_rsp*r3_RSP)-1)*100, contri_O3 = round(rO3/(rO3+rNO2+rSO2+rRSP)*100, 1),
contri_NO2 = round(rNO2/(rO3+rNO2+rSO2+rRSP)*100,1), contri_SO2 = round(rSO2/(rO3+rNO2+rSO2+rRSP)*100,1),
contri_RSP = round(rRSP/(rO3+rNO2+rSO2+rRSP)*100,1), Ox_ppb = round(r3_O3/1.996464+r3_NO2/1.913278,1))
vec1 = c("O3", "NO2", "SO2", "RSP")
risk_hourly$dom = apply(risk_hourly[,c("contri_O3", "contri_NO2", "contri_SO2", "contri_RSP")], 1,
function(x) vec1[match(max(x), x, incomparables = NA, nomatch = NA)])
risk_hourly_Dup_11 = risk_hourly %>% filter(AQHI == 11)
risk_hourly_Dup_11$AQHI = "Dup_11"
risk_hourly_Dup_11$siteMax = "Dup_11"
risk_hourly = rbind.data.frame(risk_hourly, risk_hourly_Dup_11)
risk_hourly[c("fsp", "r3_O3", "r3_NO2", "r3_SO2", "r3_RSP", "r3_NOx", "rO3", "rNO2", "rSO2", "rRSP")] = NULL
roll3hr = m1
roll3hr = rollingMean(roll3hr, pollutant = c("o3_ug"), align = "right", width = 3,
data.thresh = 66.6, type = "site", new.name = "r3_O3")
roll3hr = rollingMean(roll3hr, pollutant = c("no2_ug"), align = "right", width = 3,
data.thresh = 66.6, type = "site", new.name = "r3_NO2")
roll3hr = rollingMean(roll3hr, pollutant = c("so2_ug"), align = "right", width = 3,
data.thresh = 66.6, type = "site", new.name = "r3_SO2")
roll3hr = rollingMean(roll3hr, pollutant = c("rsp"), align = "right", width = 3,
data.thresh = 66.6, type = "site", new.name = "r3_RSP")
roll3hr = rollingMean(roll3hr, pollutant = c("nox_ug"), align = "right", width = 3,
data.thresh = 66.6, type = "site", new.name = "r3_NOx")
roll3hr = selectByDate(roll3hr, year = 2014:2016)
risk_hourly = roll3hr %>%
mutate(rO3 = (exp(f_o3*r3_O3)-1)*100, rNO2 = (exp(f_no2*r3_NO2)-1)*100, rSO2 = (exp(f_so2*r3_SO2)-1)*100,
rRSP = (exp(f_rsp*r3_RSP)-1)*100, contri_O3 = round(rO3/(rO3+rNO2+rSO2+rRSP)*100, 1),
contri_NO2 = round(rNO2/(rO3+rNO2+rSO2+rRSP)*100,1), contri_SO2 = round(rSO2/(rO3+rNO2+rSO2+rRSP)*100,1),
contri_RSP = round(rRSP/(rO3+rNO2+rSO2+rRSP)*100,1), Ox_ppb = round(r3_O3/1.996464+r3_NO2/1.913278,1))
vec1 = c("O3", "NO2", "SO2", "RSP")
risk_hourly$dom = apply(risk_hourly[,c("contri_O3", "contri_NO2", "contri_SO2", "contri_RSP")], 1,
function(x) vec1[match(max(x), x, incomparables = NA, nomatch = NA)])
risk_hourly_Dup_11 = risk_hourly %>% filter(AQHI == 11)
risk_hourly_Dup_11$AQHI = "Dup_11"
risk_hourly_Dup_11$siteMax = "Dup_11"
risk_hourly = rbind.data.frame(risk_hourly, risk_hourly_Dup_11)
risk_hourly[c("fsp", "r3_O3", "r3_NO2", "r3_SO2", "r3_RSP", "r3_NOx", "rO3", "rNO2", "rSO2", "rRSP")] = NULL
View(risk_hourly)
WriteCSV_ToFolder(dir_West_v_East, dir_Master, risk_hourly[c("date", "site", "AQHI", "siteMax",
"contri_O3", "contri_NO2", "contri_SO2", "contri_RSP", "o3_ug", "no2_ug", "rsp", "nox_ug", "Ox_ppb", "dom")], "risk_hourly.csv")
WriteCSV_ToFolder(dir_West_v_East, dir_Master, risk_hourly[c("date", "site", "AQHI", "siteMax",
"contri_O3", "contri_NO2", "contri_SO2", "contri_RSP", "o3_ug", "no2_ug", "so2_ug","rsp", "nox_ug", "Ox_ppb", "dom")], "risk_hourly.csv")
## ------   ------   ------   ------   ------   ------   ------   ------   ------   ------   ------   ------
